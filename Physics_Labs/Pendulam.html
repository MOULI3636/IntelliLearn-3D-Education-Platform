<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Interactive Pendulum Simulation</title>
<script src="https://cdn.tailwindcss.com"></script>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
<style>
body {
  font-family: 'Inter', sans-serif;
  background-color: white;
  color: #2d3748;
  overflow: hidden; /* Prevent overall page scrolling */
}
.control-panel {
  background-color: white;
  border: 2px solid #10b981;
  box-shadow: 0 0 10px rgba(16, 185, 129, 0.5);
  border-radius: 8px;
  height: 400px; /* Match pendulum height */
  overflow-y: auto; /* Add scrolling */
}
input[type="range"] {
  -webkit-appearance: none;
  appearance: none;
  width: 100%;
  height: 8px;
  background: #e2e8f0;
  border-radius: 5px;
  outline: none;
  transition: all 0.3s;
}
input[type="range"]:hover {
  background: #cbd5e0;
}
input[type="range"]::-webkit-slider-thumb {
  -webkit-appearance: none;
  appearance: none;
  width: 18px;
  height: 18px;
  background: #10b981;
  cursor: pointer;
  border-radius: 50%;
  box-shadow: 0 0 5px rgba(16, 185, 129, 0.6);
}
input[type="range"]::-moz-range-thumb {
  width: 18px;
  height: 18px;
  background: #10b981;
  cursor: pointer;
  border-radius: 50%;
  box-shadow: 0 0 5px rgba(16, 185, 129, 0.6);
}
canvas {
  background: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="400" height="400" viewBox="0 0 400 400"><rect x="0" y="0" width="400" height="400" fill="%23a67b5b"/><path d="M0,0 L400,400 M400,0 L0,400" stroke="%238b5a2b" stroke-width="5" opacity="0.1"/></svg>');
  border-radius: 8px;
  box-shadow: 0 0 10px rgba(0, 0, 0, 0.3);
}
.clock {
  background: white;
  border: 2px solid #10b981;
  border-radius: 8px;
  padding: 10px;
  font-family: 'Courier New', monospace;
  box-shadow: 0 0 10px rgba(16, 185, 129, 0.3);
}
.mass-display {
  position: absolute;
  transform: translate(-50%, -50%);
  background: rgba(255, 255, 255, 0.9);
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  color: #2d3748;
  font-weight: bold;
  border: 2px solid #000000;
  box-shadow: 0 0 5px rgba(0, 0, 0, 0.5);
  pointer-events: none;
}
.angle-display {
  position: absolute;
  background: rgba(255, 255, 255, 0.9);
  padding: 6px 10px;
  border-radius: 15px;
  border: 2px solid #000000;
  box-shadow: 0 0 5px rgba(0, 0, 0, 0.5);
  font-weight: bold;
  pointer-events: none;
}
.control-card {
  background: white;
  border-radius: 8px;
  padding: 10px;
  box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
  border: 1px solid #e2e8f0;
  transition: all 0.3s;
}
.control-card:hover {
  box-shadow: 0 5px 10px -3px rgba(16, 185, 129, 0.2);
}
/* .header-glow {
  text-shadow: 0 0 5px rgba(16, 185, 129, 0.5);
} */
.info-bubble {
  position: relative;
  display: inline-block;
  margin-left: 5px;
  cursor: help;
}
.info-bubble .info-text {
  visibility: hidden;
  width: 180px;
  background-color: #2d3748;
  color: white;
  text-align: center;
  border-radius: 6px;
  padding: 5px;
  position: absolute;
  z-index: 1;
  bottom: 125%;
  left: 50%;
  margin-left: -90px;
  opacity: 0;
  transition: opacity 0.3s;
  font-weight: normal;
  font-size: 11px;
}
.info-bubble:hover .info-text {
  visibility: visible;
  opacity: 1;
}
.wooden-stand {
  position: absolute;
  width: 250px;
  height: 15px;
  background: #5d4037;
  border-radius: 5px 5px 0 0;
  top: 25px;
  left: 50%;
  transform: translateX(-50%);
  box-shadow: 0 2px 4px rgba(0,0,0,0.3);
  z-index: 1;
}
.stand-support {
  position: absolute;
  width: 15px;
  height: 25px;
  background: #4e342e;
  top: 0;
  left: 50%;
  transform: translateX(-50%);
}
.table {
  position: absolute;
  bottom: 0;
  width: 100%;
  height: 25px;
  background: #6d4c41;
  border-radius: 5px 5px 0 0;
  box-shadow: 0 -2px 8px rgba(0,0,0,0.4);
}
/* Modal styles */
.modal {
  display: none;
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background-color: rgba(0, 0, 0, 0.7);
  z-index: 1000;
  overflow-y: auto;
}
.modal-content {
  position: relative;
  background-color: #fefefe;
  margin: 5% auto;
  padding: 20px;
  border-radius: 8px;
  width: 80%;
  max-width: 800px;
  box-shadow: 0 5px 20px rgba(0, 0, 0, 0.3);
  max-height: 80vh;
  overflow-y: auto;
}
.close {
  position: absolute;
  top: 10px;
  right: 20px;
  font-size: 24px;
  font-weight: bold;
  color: #10b981;
  cursor: pointer;
}
.close:hover {
  color: #059669;
}
.theory-section {
  margin-bottom: 20px;
}
.theory-section h3 {
  color: #10b981;
  border-bottom: 1px solid #e2e8f0;
  padding-bottom: 6px;
  margin-bottom: 12px;
}
.example-box {
  background-color: #f0fdf4;
  border-left: 3px solid #10b981;
  padding: 12px;
  margin: 12px 0;
  border-radius: 0 6px 6px 0;
}
.formula {
  font-family: 'Courier New', monospace;
  background-color: #ecfdf5;
  padding: 8px 12px;
  border-radius: 4px;
  margin: 8px 0;
  display: inline-block;
}
.back-menu {
  position: absolute;
  top: 10px;
  right: 10px;
  background: #10b981;
  color: white;
  border: none;
  border-radius: 4px;
  padding: 5px 10px;
  font-size: 12px;
  cursor: pointer;
  box-shadow: 0 0 5px rgba(16, 185, 129, 0.5);
  z-index: 10;
}
/* Light green heading */
.light-green-heading {
  color: #059669; /* Light green color */
}
</style>
</head>
<body class="flex flex-col items-center justify-center min-h-screen p-4">

<div class="w-full max-w-5xl mx-auto relative">
<!-- <button class="back-menu">
  <i class="fas fa-arrow-left mr-1"></i>Back
</button> -->

<header class="text-center mb-4">
<h1 class="text-2xl md:text-3xl font-bold light-green-heading header-glow">
<i class="fas fa-clock mr-2"></i>Interactive Pendulum Simulation
</h1>
<p class="text-sm text-emerald-600 mt-1">Explore physics concepts like period, frequency, and harmonic motion!</p>
</header>

<div class="flex flex-col lg:flex-row gap-4 mb-4">
<!-- Clock Display -->
<div class="clock text-center flex-1">
    <h2 class="text-lg font-semibold mb-1 light-green-heading"><i class="far fa-clock mr-1"></i>Simulation Time</h2>
    <div id="clockDisplay" class="text-xl font-mono text-emerald-800">00:00:00.0</div>
</div>

<!-- Physics Info Panel -->
<div class="clock text-center flex-1">
    <h2 class="text-lg font-semibold mb-1 light-green-heading"><i class="fas fa-info-circle mr-1"></i>Physics Data</h2>
    <div class="grid grid-cols-2 gap-1 text-left px-2 text-xs">
        <div>Period:</div>
        <div id="periodDisplay" class="font-mono text-emerald-800">0.00s</div>
        <div>Frequency:</div>
        <div id="frequencyDisplay" class="font-mono text-emerald-800">0.00Hz</div>
        <div>Amplitude:</div>
        <div id="amplitudeDisplay" class="font-mono text-emerald-800">0.00°</div>
        <div>Energy:</div>
        <div id="energyDisplay" class="font-mono text-emerald-800">0.00J</div>
    </div>
</div>
</div>

<main class="flex flex-col lg:flex-row gap-4">
<!-- Simulation Canvas -->
<div class="flex-grow relative">
<canvas id="simulationCanvas" class="mx-auto"></canvas>
<div class="wooden-stand">
  <div class="stand-support"></div>
</div>
<div class="table"></div>
<div id="angleDisplay" class="angle-display">45°</div>
</div>

<!-- Controls -->
<div class="control-panel w-full lg:w-80 p-4 flex-shrink-0">
<h2 class="text-xl font-semibold mb-4 border-b border-emerald-200 pb-2 light-green-heading">
<i class="fas fa-sliders-h mr-2"></i>Controls
</h2>
<div class="space-y-4">
<div class="control-card">
<label for="lengthSlider" class="block mb-1 text-xs font-medium text-emerald-700">
<i class="fas fa-ruler-vertical mr-1"></i>Pendulum Length
<span class="info-bubble text-emerald-500">
<i class="fas fa-question-circle"></i>
<span class="info-text">Longer pendulums swing slower with a longer period</span>
</span>
</label>
<input id="lengthSlider" type="range" min="50" max="400" value="200" class="w-full">
<span id="lengthValue" class="text-emerald-600 font-mono text-xs mt-1 block">200 pixels</span>
</div>

<div class="control-card">
<label for="gravitySlider" class="block mb-1 text-xs font-medium text-emerald-700">
<i class="fas fa-weight-hanging mr-1"></i>Gravity
<span class="info-bubble text-emerald-500">
<i class="fas fa-question-circle"></i>
<span class="info-text">Higher gravity makes the pendulum swing faster</span>
</span>
</label>
<input id="gravitySlider" type="range" min="0.01" max="0.5" value="0.1" step="0.01" class="w-full">
<span id="gravityValue" class="text-emerald-600 font-mono text-xs mt-1 block">0.10 m/s²</span>
</div>

<div class="control-card">
<label for="angleSlider" class="block mb-1 text-xs font-medium text-emerald-700">
<i class="fas fa-angle-left mr-1"></i>Initial Angle
<span class="info-bubble text-emerald-500">
<i class="fas fa-question-circle"></i>
<span class="info-text">Larger angles create wider swings but don't affect period time</span>
</span>
</label>
<input id="angleSlider" type="range" min="-90" max="90" value="45" step="1" class="w-full">
<span id="angleValue" class="text-emerald-600 font-mono text-xs mt-1 block">45 degrees</span>
</div>

<div class="control-card">
<label for="massSlider" class="block mb-1 text-xs font-medium text-emerald-700">
<i class="fas fa-weight mr-1"></i>Bob Mass
<span class="info-bubble text-emerald-500">
<i class="fas fa-question-circle"></i>
<span class="info-text">Mass doesn't affect the swing period in ideal conditions</span>
</span>
</label>
<input id="massSlider" type="range" min="1" max="20" value="5" step="1" class="w-full">
<span id="massValue" class="text-emerald-600 font-mono text-xs mt-1 block">5 kg</span>
</div>

<div class="control-card">
<label for="dampingSlider" class="block mb-1 text-xs font-medium text-emerald-700">
<i class="fas fa-wind mr-1"></i>Damping
<span class="info-bubble text-emerald-500">
<i class="fas fa-question-circle"></i>
<span class="info-text">Lower values mean more air resistance, slowing the pendulum faster</span>
</span>
</label>
<input id="dampingSlider" type="range" min="0.99" max="1.0" value="0.995" step="0.001" class="w-full">
<span id="dampingValue" class="text-emerald-600 font-mono text-xs mt-1 block">0.995</span>
</div>
</div>

<div class="flex space-x-3 mt-6">
<button id="resetButton" class="flex-1 bg-emerald-600 hover:bg-emerald-700 text-white font-bold py-2 px-3 rounded-lg transition duration-300 ease-in-out transform hover:scale-105 text-sm">
<i class="fas fa-redo mr-1"></i>Reset
</button>

<button id="pauseButton" class="flex-1 bg-emerald-500 hover:bg-emerald-600 text-white font-bold py-2 px-3 rounded-lg transition duration-300 ease-in-out transform hover:scale-105 text-sm">
<i class="fas fa-pause mr-1"></i>Pause
</button>
</div>

<div class="flex space-x-3 mt-3">
<button id="demoButton" class="flex-1 bg-blue-500 hover:bg-blue-600 text-white font-bold py-2 px-3 rounded-lg transition duration-300 ease-in-out transform hover:scale-105 text-sm">
<i class="fas fa-magic mr-1"></i>Demo Mode
</button>

<button id="theoryButton" class="flex-1 bg-green-500 hover:bg-green-600 text-white font-bold py-2 px-3 rounded-lg transition duration-300 ease-in-out transform hover:scale-105 text-sm">
<i class="fas fa-book mr-1"></i>Theory
</button>
</div>
</div>
</main>
</div>

<!-- Theory Modal -->
<div id="theoryModal" class="modal">
<div class="modal-content">
<span class="close">&times;</span>
<h2 class="text-2xl font-bold light-green-heading mb-4 text-center"><i class="fas fa-book-open mr-2"></i>Pendulum Physics Theory</h2>

<div class="theory-section">
<h3 class="text-xl font-semibold">What is a Pendulum?</h3>
<p class="text-sm">A pendulum is a weight suspended from a pivot so that it can swing freely. When displaced from its equilibrium position and released, gravity causes it to oscillate back and forth about the equilibrium position. The time for one complete cycle (left swing and right swing) is called the period.</p>
</div>

<div class="theory-section">
<h3 class="text-xl font-semibold">Simple Harmonic Motion</h3>
<p class="text-sm">For small angles (typically less than about 15°), a pendulum follows simple harmonic motion very closely. In this approximation:</p>
<div class="formula text-sm">θ(t) = θ₀·cos(√(g/L)·t)</div>
<p class="text-sm">Where:</p>
<ul class="list-disc list-inside ml-4 mb-3 text-sm">
<li>θ(t) is the angular displacement at time t</li>
<li>θ₀ is the initial angular displacement</li>
<li>g is the acceleration due to gravity</li>
<li>L is the length of the pendulum</li>
</ul>

<div class="example-box">
<h4 class="font-semibold mb-1 text-sm">Example:</h4>
<p class="text-sm">If a pendulum has a length of 1 meter and is on Earth (g = 9.8 m/s²), its period would be:</p>
<div class="formula text-sm">T = 2π√(1/9.8) ≈ 2.0 seconds</div>
<p class="text-sm">This means it would take approximately 2 seconds to complete one full swing (back and forth).</p>
</div>
</div>

<div class="theory-section">
<h3 class="text-xl font-semibold">The Period Formula</h3>
<p class="text-sm">The period T of a simple pendulum is given by:</p>
<div class="formula text-sm">T = 2π√(L/g)</div>
<p class="text-sm">Where:</p>
<ul class="list-disc list-inside ml-4 mb-3 text-sm">
<li>T is the period (time for one complete cycle)</li>
<li>L is the length of the pendulum</li>
<li>g is the acceleration due to gravity</li>
</ul>
<p class="text-sm">Notice that the period depends only on the length of the pendulum and the strength of gravity, not on the mass of the bob or the amplitude of the swing (for small angles).</p>

<div class="example-box">
<h4 class="font-semibold mb-1 text-sm">Practical Application:</h4>
<p class="text-sm">Pendulum clocks use the regular motion of a pendulum to keep time. The length is carefully adjusted so the period is exactly 1 second for a seconds pendulum (2 seconds for a complete cycle).</p>
</div>
</div>
</div>
</div>

<script>
const canvas = document.getElementById('simulationCanvas');
const ctx = canvas.getContext('2d');

// Set canvas dimensions
canvas.width = 500;
canvas.height = 400;

// Controls
const lengthSlider = document.getElementById('lengthSlider');
const gravitySlider = document.getElementById('gravitySlider');
const angleSlider = document.getElementById('angleSlider');
const massSlider = document.getElementById('massSlider');
const dampingSlider = document.getElementById('dampingSlider');
const resetButton = document.getElementById('resetButton');
const pauseButton = document.getElementById('pauseButton');
const demoButton = document.getElementById('demoButton');
const theoryButton = document.getElementById('theoryButton');
const clockDisplay = document.getElementById('clockDisplay');

// Modal elements
const theoryModal = document.getElementById('theoryModal');
const closeModal = document.getElementsByClassName('close')[0];

// Physics displays
const periodDisplay = document.getElementById('periodDisplay');
const frequencyDisplay = document.getElementById('frequencyDisplay');
const amplitudeDisplay = document.getElementById('amplitudeDisplay');
const energyDisplay = document.getElementById('energyDisplay');
const angleDisplay = document.getElementById('angleDisplay');

// Display values
const lengthValue = document.getElementById('lengthValue');
const gravityValue = document.getElementById('gravityValue');
const angleValue = document.getElementById('angleValue');
const massValue = document.getElementById('massValue');
const dampingValue = document.getElementById('dampingValue');

// Pendulum properties
let length = parseInt(lengthSlider.value);
let gravity = parseFloat(gravitySlider.value);
let angle = parseFloat(angleSlider.value) * Math.PI / 180; // Convert to radians
let mass = parseInt(massSlider.value);
let damping = parseFloat(dampingSlider.value);
let angularVelocity = 0;
let angularAcceleration = 0;
const origin = { x: canvas.width / 2, y: 60 }; // Adjusted to connect to the stand
let bobPosition = { x: 0, y: 0 };
let isDragging = false;
let trail = [];
const maxTrailLength = 40;

// Physics tracking
let period = 0;
let frequency = 0;
let amplitude = Math.abs(parseFloat(angleSlider.value));
let energy = 0;
let lastZeroCrossing = 0;
let crossingCount = 0;

// Time tracking
let startTime = null;
let elapsedTime = 0;
let lastTime = 0;
let isPaused = false;
let isDemoMode = false;

// Update display values
function updateDisplayValues() {
  lengthValue.textContent = length + ' pixels';
  gravityValue.textContent = gravity.toFixed(2) + ' m/s²';
  angleValue.textContent = angleSlider.value + ' degrees';
  massValue.textContent = mass + ' kg';
  dampingValue.textContent = damping.toFixed(3);
  
  // Update physics displays
  periodDisplay.textContent = period.toFixed(2) + 's';
  frequencyDisplay.textContent = frequency.toFixed(2) + 'Hz';
  amplitudeDisplay.textContent = amplitude.toFixed(2) + '°';
  energyDisplay.textContent = energy.toFixed(2) + 'J';
  
  // Update angle display position
  const displayAngle = (angle * 180 / Math.PI).toFixed(1);
  angleDisplay.textContent = displayAngle + '°';
  angleDisplay.style.left = (origin.x + 40) + 'px';
  angleDisplay.style.top = (origin.y + 15) + 'px';
}

// Reset the timer
function resetTimer() {
  startTime = null;
  elapsedTime = 0;
  clockDisplay.textContent = formatTime(0);
  lastZeroCrossing = 0;
  crossingCount = 0;
  period = 0;
  frequency = 0;
}

// Format time for display
function formatTime(milliseconds) {
  const totalSeconds = milliseconds / 1000;
  const hours = Math.floor(totalSeconds / 3600);
  const minutes = Math.floor((totalSeconds % 3600) / 60);
  const seconds = Math.floor(totalSeconds % 60);
  const tenths = Math.floor((milliseconds % 1000) / 100);
  
  return hours.toString().padStart(2, '0') + ':' + 
         minutes.toString().padStart(2, '0') + ':' + 
         seconds.toString().padStart(2, '0') + '.' + 
         tenths;
}

// Update clock display
function updateClock(timestamp) {
  if (!startTime) {
    startTime = timestamp;
    lastTime = timestamp;
  }
  
  if (!isPaused) {
    const deltaTime = timestamp - lastTime;
    elapsedTime += deltaTime;
    lastTime = timestamp;
    clockDisplay.textContent = formatTime(elapsedTime);
  } else {
    lastTime = timestamp;
  }
}

// Calculate bob position
function calculateBobPosition() {
  bobPosition.x = origin.x + length * Math.sin(angle);
  bobPosition.y = origin.y + length * Math.cos(angle);
}

// Draw mass display - now drawn directly on the bob
function drawMassDisplay() {
  // Remove previous mass display if exists
  const prevDisplay = document.querySelector('.mass-display');
  if (prevDisplay) {
    prevDisplay.remove();
  }
  
  const massDisplay = document.createElement('div');
  massDisplay.className = 'mass-display';
  massDisplay.textContent = mass + ' kg';
  massDisplay.style.width = (25 + mass * 2) + 'px';
  massDisplay.style.height = (25 + mass * 2) + 'px';
  massDisplay.style.left = bobPosition.x + 'px';
  massDisplay.style.top = bobPosition.y + 'px';
  
  document.querySelector('.relative').appendChild(massDisplay);
}

// Calculate physics values
function calculatePhysics(timestamp) {
  // Calculate period and frequency
  if (Math.sign(angularVelocity) !== Math.sign(Math.sin(angle)) && Math.abs(angle) < 0.1) {
    if (lastZeroCrossing > 0) {
      period = (timestamp - lastZeroCrossing) / 500; // Divide by 500 because we cross zero twice per period
      frequency = 1 / period;
    }
    lastZeroCrossing = timestamp;
    crossingCount++;
  }
  
  // Calculate amplitude in degrees
  amplitude = Math.abs(angle * 180 / Math.PI);
  
  // Calculate energy (potential + kinetic)
  const height = length * (1 - Math.cos(angle));
  const potentialEnergy = mass * gravity * height;
  const kineticEnergy = 0.5 * mass * Math.pow(angularVelocity * length, 2);
  energy = potentialEnergy + kineticEnergy;
}

// Draw the pendulum
function draw() {
  // Clear canvas
  ctx.clearRect(0, 0, canvas.width, canvas.height);
  
  // Draw trail
  if (trail.length > 1) {
    ctx.beginPath();
    ctx.moveTo(trail[0].x, trail[0].y);
    for (let i = 1; i < trail.length; i++) {
      const point = trail[i];
      ctx.lineTo(point.x, point.y);
      // Fade out the trail with black color
      const alpha = i / trail.length;
      ctx.strokeStyle = 'rgba(0, 0, 0, ' + alpha + ')';
      ctx.lineWidth = 2;
    }
    ctx.stroke();
  }
  
  // Draw angle indicator
  ctx.beginPath();
  ctx.arc(origin.x, origin.y, 25, -Math.PI/2, -Math.PI/2 + angle, angle < 0);
  ctx.strokeStyle = '#000000';
  ctx.lineWidth = 2;
  ctx.stroke();
  
  // Draw string
  ctx.beginPath();
  ctx.moveTo(origin.x, origin.y);
  ctx.lineTo(bobPosition.x, bobPosition.y);
  ctx.strokeStyle = '#2d3748';
  ctx.lineWidth = 2;
  ctx.stroke();
  
  // Draw origin point (connection to stand)
  ctx.beginPath();
  ctx.arc(origin.x, origin.y, 4, 0, Math.PI * 2);
  ctx.fillStyle = '#5d4037';
  ctx.fill();
  ctx.strokeStyle = '#4e342e';
  ctx.lineWidth = 2;
  ctx.stroke();
  
  // Draw bob with size based on mass
  const bobRadius = 12 + mass;
  ctx.beginPath();
  ctx.arc(bobPosition.x, bobPosition.y, bobRadius, 0, Math.PI * 2);
  
  // Create a metallic gradient for the bob
  const gradient = ctx.createRadialGradient(
    bobPosition.x - 4, bobPosition.y - 4, 1,
    bobPosition.x, bobPosition.y, bobRadius
  );
  gradient.addColorStop(0, '#ffffff');
  gradient.addColorStop(0.5, '#a0a0a0');
  gradient.addColorStop(1, '#505050');
  
  ctx.fillStyle = gradient;
  ctx.fill();
  ctx.strokeStyle = '#000000';
  ctx.lineWidth = 2;
  ctx.stroke();
  
  // Draw mass text on the bob
  ctx.font = `${mass > 10 ? 'bold 10px' : 'bold 12px'} Inter`;
  ctx.fillStyle = '#000';
  ctx.textAlign = 'center';
  ctx.textBaseline = 'middle';
  ctx.fillText(`${mass} kg`, bobPosition.x, bobPosition.y);
}

// Update pendulum physics
function update() {
  if (!isDragging && !isPaused) {
    // Calculate acceleration (mass doesn't affect acceleration in a pendulum)
    angularAcceleration = (-gravity / length) * Math.sin(angle);
    
    // Update velocity and angle
    angularVelocity += angularAcceleration;
    angularVelocity *= damping;
    angle += angularVelocity;
    
    // Calculate new position
    calculateBobPosition();
    
    // Add to trail
    trail.push({x: bobPosition.x, y: bobPosition.y});
    if (trail.length > maxTrailLength) {
      trail.shift();
    }
  }
}

// Demo mode function
function runDemoMode() {
  if (!isDemoMode) return;
  
  // Slowly change parameters for demonstration
  const time = elapsedTime / 1000;
  
  // Oscillate length
  length = 200 + 100 * Math.sin(time * 0.2);
  lengthSlider.value = length;
  
  // Oscillate gravity
  gravity = 0.1 + 0.2 * (0.5 + 0.5 * Math.sin(time * 0.3));
  gravitySlider.value = gravity.toFixed(2);
  
  // Oscillate damping
  damping = 0.999 - 0.004 * (0.5 + 0.5 * Math.sin(time * 0.5));
  dampingSlider.value = damping.toFixed(3);
  
  // Update displays
  updateDisplayValues();
}

// Animation loop
function animate(timestamp) {
  updateClock(timestamp);
  update();
  calculatePhysics(timestamp);
  draw();
  updateDisplayValues();
  runDemoMode();
  requestAnimationFrame(animate);
}

// Initialize
calculateBobPosition();
updateDisplayValues();

// Start animation
requestAnimationFrame(animate);

// Event listeners for sliders
lengthSlider.addEventListener('input', function() {
  length = parseInt(this.value);
  calculateBobPosition();
  angularVelocity = 0;
  trail = [];
  resetTimer();
  updateDisplayValues();
});

gravitySlider.addEventListener('input', function() {
  gravity = parseFloat(this.value);
  angularVelocity = 0;
  trail = [];
  resetTimer();
  updateDisplayValues();
});

angleSlider.addEventListener('input', function() {
  angle = parseFloat(this.value) * Math.PI / 180;
  calculateBobPosition();
  angularVelocity = 0;
  trail = [];
  resetTimer();
  updateDisplayValues();
});

massSlider.addEventListener('input', function() {
  mass = parseInt(this.value);
  angularVelocity = 0;
  trail = [];
  resetTimer();
  updateDisplayValues();
});

dampingSlider.addEventListener('input', function() {
  damping = parseFloat(this.value);
  angularVelocity = 0;
  trail = [];
  resetTimer();
  updateDisplayValues();
});

// Reset button
resetButton.addEventListener('click', function() {
  lengthSlider.value = 200;
  gravitySlider.value = 0.1;
  angleSlider.value = 45;
  massSlider.value = 5;
  dampingSlider.value = 0.995;
  
  length = parseInt(lengthSlider.value);
  gravity = parseFloat(gravitySlider.value);
  angle = parseFloat(angleSlider.value) * Math.PI / 180;
  mass = parseInt(massSlider.value);
  damping = parseFloat(dampingSlider.value);
  angularVelocity = 0;
  trail = [];
  
  // Reset time
  resetTimer();
  isPaused = false;
  isDemoMode = false;
  
  calculateBobPosition();
  updateDisplayValues();
  pauseButton.innerHTML = '<i class="fas fa-pause mr-1"></i>Pause';
  demoButton.innerHTML = '<i class="fas fa-magic mr-1"></i>Demo Mode';
});

// Pause button
pauseButton.addEventListener('click', function() {
  isPaused = !isPaused;
  this.innerHTML = isPaused ? 
    '<i class="fas fa-play mr-1"></i>Resume' : 
    '<i class="fas fa-pause mr-1"></i>Pause';
});

// Demo button
demoButton.addEventListener('click', function() {
  isDemoMode = !isDemoMode;
  this.innerHTML = isDemoMode ? 
    '<i class="fas fa-stop mr-1"></i>Stop Demo' : 
    '<i class="fas fa-magic mr-1"></i>Demo Mode';
});

// Theory button - open modal
theoryButton.addEventListener('click', function() {
  theoryModal.style.display = "block";
});

// Close modal when clicking on X
closeModal.addEventListener('click', function() {
  theoryModal.style.display = "none";
});

// Close modal when clicking outside of it
window.addEventListener('click', function(event) {
  if (event.target == theoryModal) {
    theoryModal.style.display = "none";
  }
});

// Mouse interaction for dragging the bob
canvas.addEventListener('mousedown', function(e) {
  const rect = canvas.getBoundingClientRect();
  const mouseX = e.clientX - rect.left;
  const mouseY = e.clientY - rect.top;
  
  // Check if mouse is near the bob
  const bobRadius = 12 + mass;
  const dx = mouseX - bobPosition.x;
  const dy = mouseY - bobPosition.y;
  const distance = Math.sqrt(dx * dx + dy * dy);
  
  if (distance < bobRadius) {
    isDragging = true;
    trail = [];
    resetTimer();
  }
});

canvas.addEventListener('mousemove', function(e) {
  if (isDragging) {
    const rect = canvas.getBoundingClientRect();
    const mouseX = e.clientX - rect.left;
    const mouseY = e.clientY - rect.top;
    
    // Calculate new angle based on mouse position
    const dx = mouseX - origin.x;
    const dy = mouseY - origin.y;
    angle = Math.atan2(dx, dy);
    
    // Limit the angle to prevent flipping
    angle = Math.max(Math.min(angle, Math.PI/2), -Math.PI/2);
    
    // Update position
    calculateBobPosition();
    updateDisplayValues();
  }
});

canvas.addEventListener('mouseup', function() {
  if (isDragging) {
    isDragging = false;
    
    // Calculate new velocity based on how fast the mouse was moving
    angularVelocity = 0;
  }
});

canvas.addEventListener('mouseleave', function() {
  isDragging = false;
});

// Back menu button functionality
document.querySelector('.back-menu').addEventListener('click', function() {
  alert("This would navigate back to the main menu in a complete application.");
});
</script>
</body>
</html>