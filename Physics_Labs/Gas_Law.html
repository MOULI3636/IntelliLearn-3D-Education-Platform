<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gas Laws Virtual Lab</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            overflow-x: hidden;
            background-color: #f9fafb;
        }
        
        .experiment-container {
            border: 2px solid #10b981;
            box-shadow: 0 0 15px rgba(16, 185, 129, 0.3);
            transition: all 0.3s ease;
        }
        
        .experiment-container:hover {
            box-shadow: 0 0 20px rgba(16, 185, 129, 0.5);
        }
        
        .gas-particle {
            position: absolute;
            width: 8px;
            height: 8px;
            border-radius: 50%;
            transition: all 0.3s ease;
        }
        
        .piston-container {
            transition: all 0.5s ease;
        }
        
        .piston-rod {
            transition: all 0.5s ease;
        }
        
        .flame {
            position: absolute;
            width: 100%;
            height: 30px;
            bottom: 0;
            background: linear-gradient(to top, rgba(255, 0, 0, 0.8), rgba(255, 165, 0, 0.6), transparent);
            border-radius: 50% 50% 0 0;
            opacity: 0;
            transition: opacity 0.5s ease;
        }
        
        .flame.active {
            opacity: 0.7;
            animation: flicker 0.3s infinite alternate;
        }
        
        @keyframes flicker {
            0% { opacity: 0.6; }
            100% { opacity: 0.8; }
        }
        
        .highlight {
            background-color: #f0fdf4;
            transition: background-color 0.5s ease;
        }
        
        @keyframes moveParticle {
            0% { transform: translate(0, 0); }
            25% { transform: translate(var(--tx1), var(--ty1)); }
            50% { transform: translate(var(--tx2), var(--ty2)); }
            75% { transform: translate(var(--tx3), var(--ty3)); }
            100% { transform: translate(0, 0); }
        }
        
        .chamber-wall {
            background: linear-gradient(to bottom, #e5e7eb, #d1d5db);
            box-shadow: inset 0 0 10px rgba(0, 0, 0, 0.1);
        }
        
        .piston-head {
            background: linear-gradient(to bottom, #9ca3af, #6b7280);
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
        }
        
        .piston-rod {
            background: linear-gradient(to bottom, #737373, #525252);
        }
        
        .temperature-indicator {
            position: absolute;
            right: -40px;
            width: 30px;
            height: 200px;
            background: linear-gradient(to top, #3b82f6, #ef4444);
            border-radius: 5px;
            border: 2px solid #4b5563;
        }
        
        .temperature-marker {
            position: absolute;
            right: -50px;
            width: 40px;
            height: 2px;
            background-color: #4b5563;
        }
        
        .temperature-value {
            position: absolute;
            right: -70px;
            transform: translateY(-50%);
            font-size: 12px;
            color: #4b5563;
        }
        
        .tab-button {
            transition: all 0.3s ease;
        }
        
        .tab-button.active {
            background-color: #10b981;
            color: white;
        }
        
        .theory-content {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.5s ease;
        }
        
        .theory-content.open {
            max-height: 1000px;
        }
        
        .back-button {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 100;
        }
    </style>
</head>
<body class="text-gray-800">
    <!-- Back to Menu Button -->
    <!-- <button id="back-btn" class="back-button px-3 py-1 bg-gray-200 text-gray-700 text-sm rounded-lg hover:bg-gray-300 transition-colors">
        Back to Menu
    </button> -->

    <div class="container mx-auto p-4 sm:p-6 lg:p-8">
        <header class="text-center mb-8">
            <h1 class="text-3xl sm:text-4xl font-bold text-gray-900">Gas Laws Virtual Lab</h1>
            <p class="mt-2 text-md sm:text-lg text-gray-600">Explore the relationships between pressure, volume, and temperature of gases</p>
        </header>

        <!-- Experiment Tabs -->
        <div class="flex justify-center mb-8">
            <div class="inline-flex rounded-lg border border-gray-300 p-1 bg-white">
                <button id="boyle-tab" class="tab-button active px-4 py-2 rounded-md font-medium">Boyle's Law</button>
                <button id="charles-tab" class="tab-button px-4 py-2 rounded-md font-medium">Charles's Law</button>
            </div>
        </div>

        <!-- Boyle's Law Experiment -->
        <div id="boyle-experiment" class="experiment-container bg-white p-6 rounded-xl">
            <div class="flex justify-between items-center mb-4">
                <h2 class="text-2xl font-semibold">Boyle's Law Experiment</h2>
                <button id="boyle-theory-btn" class="px-4 py-2 bg-green-100 text-green-700 rounded-lg hover:bg-green-200 transition-colors">
                    Theory
                </button>
            </div>
            
            <!-- Boyle's Law Theory -->
            <div id="boyle-theory" class="theory-content mb-6">
                <div class="bg-green-50 border border-green-200 p-4 rounded-lg">
                    <h3 class="text-xl font-semibold text-green-800 mb-3">Boyle's Law</h3>
                    <p class="text-green-700 mb-3">
                        Boyle's Law, named after Robert Boyle (1627-1691), states that for a fixed amount of gas at constant temperature, 
                        the pressure and volume are inversely proportional. This means that as volume increases, pressure decreases, and vice versa.
                    </p>
                    <p class="text-green-700 mb-3">
                        The mathematical expression of Boyle's Law is: <strong>P × V = k</strong>, where:
                    </p>
                    <ul class="text-green-700 list-disc pl-5 mb-3">
                        <li>P is the pressure of the gas</li>
                        <li>V is the volume of the gas</li>
                        <li>k is a constant for a given amount of gas at a constant temperature</li>
                    </ul>
                    <p class="text-green-700 mb-3">
                        This relationship can also be expressed as: <strong>P₁V₁ = P₂V₂</strong>, where the subscripts 1 and 2 refer to 
                        the initial and final states of the gas.
                    </p>
                    <p class="text-green-700">
                        Boyle's Law is a consequence of the kinetic theory of gases. When the volume of a gas is reduced, 
                        the gas particles have less space to move, resulting in more frequent collisions with the container walls, 
                        which increases the pressure.
                    </p>
                </div>
            </div>

            <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                <!-- Left side: Simulation and Controls -->
                <div class="flex flex-col items-center">
                    <!-- Data Display -->
                    <div class="w-full grid grid-cols-1 sm:grid-cols-2 gap-4 mb-6 text-center">
                        <div class="bg-blue-50 border border-blue-200 p-4 rounded-lg">
                            <p class="text-sm font-medium text-blue-700">Volume (V)</p>
                            <p id="boyle-volume-display" class="text-2xl font-bold text-blue-900">10.0 L</p>
                        </div>
                        <div class="bg-green-50 border border-green-200 p-4 rounded-lg">
                            <p class="text-sm font-medium text-green-700">Pressure (P)</p>
                            <p id="boyle-pressure-display" class="text-2xl font-bold text-green-900">1.00 atm</p>
                        </div>
                    </div>

                    <!-- Gas Container Simulation -->
                    <div class="relative w-full max-w-xs h-96 mb-4">
                        <!-- Piston Rod -->
                        <div id="boyle-piston-rod" class="piston-rod absolute left-1/2 transform -translate-x-1/2 w-4 h-20 bg-gray-500 z-10 rounded-t-lg"></div>
                        
                        <!-- Gas Chamber -->
                        <div class="absolute top-20 left-0 w-full h-80 chamber-wall rounded-lg border-2 border-gray-400 overflow-hidden" id="boyle-gas-container">
                            <!-- Gas particles will be injected here by JS -->
                        </div>
                        
                        <!-- Piston -->
                        <div id="boyle-piston-container" class="piston-container absolute left-0 w-full h-20 flex justify-center">
                            <div id="boyle-piston" class="piston-head w-11/12 h-full rounded-t-lg border-2 border-b-0 border-gray-500 flex justify-center items-start pt-2">
                                <div class="w-16 h-4 bg-gray-700 rounded-sm"></div>
                            </div>
                        </div>
                        
                        <!-- Base -->
                        <div class="absolute bottom-0 left-0 w-full h-4 bg-gray-400 rounded-b-lg"></div>
                    </div>
                    
                    <!-- Boyle's Law Equation Display -->
                    <div class="mt-4 p-4 bg-purple-50 border border-purple-200 rounded-lg w-full">
                        <p class="text-center text-purple-800 font-medium">Boyle's Law: P × V = k</p>
                        <p id="boyle-equation" class="text-center text-lg font-bold text-purple-900">1.00 × 10.0 = 10.0</p>
                    </div>

                    <!-- Controls -->
                    <div class="w-full mt-6">
                        <div class="mb-6">
                            <label for="boyle-volume-slider" class="block text-lg font-medium mb-2 text-center">Adjust Volume</label>
                            <input id="boyle-volume-slider" type="range" min="2" max="20" value="10" step="0.1" class="w-full h-3 bg-gray-200 rounded-lg appearance-none cursor-pointer range-lg">
                            <div class="flex justify-between text-sm text-gray-600 mt-1">
                                <span>2 L</span>
                                <span>20 L</span>
                            </div>
                        </div>
                        
                        <div class="mb-4">
                            <label for="boyle-pressure-slider" class="block text-lg font-medium mb-2 text-center">Adjust Pressure</label>
                            <input id="boyle-pressure-slider" type="range" min="0.5" max="5" value="1" step="0.1" class="w-full h-3 bg-gray-200 rounded-lg appearance-none cursor-pointer range-lg">
                            <div class="flex justify-between text-sm text-gray-600 mt-1">
                                <span>0.5 atm</span>
                                <span>5 atm</span>
                            </div>
                        </div>
                        
                        <div class="flex justify-center space-x-4 mt-4">
                            <button id="boyle-reset-btn" class="px-4 py-2 bg-gray-500 text-white rounded-lg hover:bg-gray-600 transition-colors">
                                Reset Experiment
                            </button>
                            <button id="boyle-auto-btn" class="px-4 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600 transition-colors">
                                Auto Cycle
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Right side: Graphs and Data -->
                <div class="flex flex-col gap-6">
                    <h2 class="text-2xl font-semibold mb-2">Data Visualization</h2>
                    
                    <div>
                        <h3 class="text-lg font-semibold text-center mb-2">Pressure vs. Volume</h3>
                        <canvas id="boyle-pv-chart"></canvas>
                    </div>
                    <div>
                        <h3 class="text-lg font-semibold text-center mb-2">Pressure vs. 1/Volume</h3>
                        <canvas id="boyle-p-inv-v-chart"></canvas>
                    </div>
                    
                    <!-- Data Table -->
                    <div class="mt-4">
                        <h3 class="text-lg font-semibold text-center mb-2">Recent Measurements</h3>
                        <div class="overflow-x-auto">
                            <table class="min-w-full divide-y divide-gray-200">
                                <thead class="bg-gray-50">
                                    <tr>
                                        <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Volume (L)</th>
                                        <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Pressure (atm)</th>
                                        <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">P × V</th>
                                    </tr>
                                </thead>
                                <tbody id="boyle-data-table-body" class="bg-white divide-y divide-gray-200">
                                    <!-- Data rows will be populated by JavaScript -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Charles's Law Experiment -->
        <div id="charles-experiment" class="experiment-container bg-white p-6 rounded-xl hidden">
            <div class="flex justify-between items-center mb-4">
                <h2 class="text-2xl font-semibold">Charles's Law Experiment</h2>
                <button id="charles-theory-btn" class="px-4 py-2 bg-green-100 text-green-700 rounded-lg hover:bg-green-200 transition-colors">
                    Theory
                </button>
            </div>
            
            <!-- Charles's Law Theory -->
            <div id="charles-theory" class="theory-content mb-6">
                <div class="bg-green-50 border border-green-200 p-4 rounded-lg">
                    <h3 class="text-xl font-semibold text-green-800 mb-3">Charles's Law</h3>
                    <p class="text-green-700 mb-3">
                        Charles's Law, named after Jacques Charles (1746-1823), states that for a fixed amount of gas at constant pressure, 
                        the volume and temperature are directly proportional. This means that as temperature increases, volume increases, and vice versa.
                    </p>
                    <p class="text-green-700 mb-3">
                        The mathematical expression of Charles's Law is: <strong>V / T = k</strong>, where:
                    </p>
                    <ul class="text-green-700 list-disc pl-5 mb-3">
                        <li>V is the volume of the gas</li>
                        <li>T is the absolute temperature of the gas (in Kelvin)</li>
                        <li>k is a constant for a given amount of gas at a constant pressure</li>
                    </ul>
                    <p class="text-green-700 mb-3">
                        This relationship can also be expressed as: <strong>V₁/T₁ = V₂/T₂</strong>, where the subscripts 1 and 2 refer to 
                        the initial and final states of the gas.
                    </p>
                    <p class="text-green-700 mb-3">
                        It's important to note that temperature must be measured in Kelvin for Charles's Law to hold true. 
                        The Kelvin scale is an absolute temperature scale where 0 K represents absolute zero, the theoretical 
                        point at which particles have minimal thermal motion.
                    </p>
                    <p class="text-green-700">
                        Charles's Law is also a consequence of the kinetic theory of gases. When the temperature of a gas increases, 
                        the average kinetic energy of the gas particles increases, causing them to move faster and collide with the 
                        container walls more forcefully. If the pressure is to remain constant, the volume must increase to accommodate 
                        these more energetic collisions.
                    </p>
                </div>
            </div>

            <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                <!-- Left side: Simulation and Controls -->
                <div class="flex flex-col items-center">
                    <!-- Data Display -->
                    <div class="w-full grid grid-cols-1 sm:grid-cols-3 gap-4 mb-6 text-center">
                        <div class="bg-blue-50 border border-blue-200 p-4 rounded-lg">
                            <p class="text-sm font-medium text-blue-700">Volume (V)</p>
                            <p id="charles-volume-display" class="text-2xl font-bold text-blue-900">10.0 L</p>
                        </div>
                        <div class="bg-red-50 border border-red-200 p-4 rounded-lg">
                            <p class="text-sm font-medium text-red-700">Temperature (T)</p>
                            <p id="charles-temperature-display" class="text-2xl font-bold text-red-900">273 K</p>
                        </div>
                        <div class="bg-green-50 border border-green-200 p-4 rounded-lg">
                            <p class="text-sm font-medium text-green-700">Pressure (P)</p>
                            <p id="charles-pressure-display" class="text-2xl font-bold text-green-900">1.00 atm</p>
                        </div>
                    </div>

                    <!-- Gas Container Simulation -->
                    <div class="relative w-full max-w-xs h-96 mb-4">
                        <!-- Temperature Indicator -->
                        <div class="temperature-indicator">
                            <div id="charles-temperature-fill" class="absolute bottom-0 w-full bg-transparent transition-all duration-500 ease-in-out"></div>
                            <!-- Temperature markers -->
                            <div class="temperature-marker" style="bottom: 0%;"></div>
                            <div class="temperature-value" style="bottom: 0%;">0 K</div>
                            <div class="temperature-marker" style="bottom: 25%;"></div>
                            <div class="temperature-value" style="bottom: 25%;">136 K</div>
                            <div class="temperature-marker" style="bottom: 50%;"></div>
                            <div class="temperature-value" style="bottom: 50%;">273 K</div>
                            <div class="temperature-marker" style="bottom: 75%;"></div>
                            <div class="temperature-value" style="bottom: 75%;">409 K</div>
                            <div class="temperature-marker" style="bottom: 100%;"></div>
                            <div class="temperature-value" style="bottom: 100%;">546 K</div>
                        </div>
                        
                        <!-- Piston Rod -->
                        <div id="charles-piston-rod" class="piston-rod absolute left-1/2 transform -translate-x-1/2 w-4 h-20 bg-gray-500 z-10 rounded-t-lg"></div>
                        
                        <!-- Gas Chamber -->
                        <div class="absolute top-20 left-0 w-full h-80 chamber-wall rounded-lg border-2 border-gray-400 overflow-hidden" id="charles-gas-container">
                            <!-- Gas particles will be injected here by JS -->
                            <!-- Flame for heating -->
                            <div id="charles-flame" class="flame"></div>
                        </div>
                        
                        <!-- Piston -->
                        <div id="charles-piston-container" class="piston-container absolute left-0 w-full h-20 flex justify-center">
                            <div id="charles-piston" class="piston-head w-11/12 h-full rounded-t-lg border-2 border-b-0 border-gray-500 flex justify-center items-start pt-2">
                                <div class="w-16 h-4 bg-gray-700 rounded-sm"></div>
                            </div>
                        </div>
                        
                        <!-- Base -->
                        <div class="absolute bottom-0 left-0 w-full h-4 bg-gray-400 rounded-b-lg"></div>
                    </div>
                    
                    <!-- Charles's Law Equation Display -->
                    <div class="mt-4 p-4 bg-purple-50 border border-purple-200 rounded-lg w-full">
                        <p class="text-center text-purple-800 font-medium">Charles's Law: V / T = k</p>
                        <p id="charles-equation" class="text-center text-lg font-bold text-purple-900">10.0 / 273 = 0.0366</p>
                    </div>

                    <!-- Controls -->
                    <div class="w-full mt-6">
                        <div class="mb-6">
                            <label for="charles-temperature-slider" class="block text-lg font-medium mb-2 text-center">Adjust Temperature</label>
                            <input id="charles-temperature-slider" type="range" min="0" max="546" value="273" step="1" class="w-full h-3 bg-gray-200 rounded-lg appearance-none cursor-pointer range-lg">
                            <div class="flex justify-between text-sm text-gray-600 mt-1">
                                <span>0 K</span>
                                <span>273 K</span>
                                <span>546 K</span>
                            </div>
                        </div>
                        
                        <div class="mb-4">
                            <label for="charles-volume-slider" class="block text-lg font-medium mb-2 text-center">Adjust Volume</label>
                            <input id="charles-volume-slider" type="range" min="5" max="20" value="10" step="0.1" class="w-full h-3 bg-gray-200 rounded-lg appearance-none cursor-pointer range-lg">
                            <div class="flex justify-between text-sm text-gray-600 mt-1">
                                <span>5 L</span>
                                <span>20 L</span>
                            </div>
                        </div>
                        
                        <div class="flex justify-center space-x-4 mt-4">
                            <button id="charles-reset-btn" class="px-4 py-2 bg-gray-500 text-white rounded-lg hover:bg-gray-600 transition-colors">
                                Reset Experiment
                            </button>
                            <button id="charles-auto-btn" class="px-4 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600 transition-colors">
                                Auto Cycle
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Right side: Graphs and Data -->
                <div class="flex flex-col gap-6">
                    <h2 class="text-2xl font-semibold mb-2">Data Visualization</h2>
                    
                    <div>
                        <h3 class="text-lg font-semibold text-center mb-2">Volume vs. Temperature</h3>
                        <canvas id="charles-vt-chart"></canvas>
                    </div>
                    <div>
                        <h3 class="text-lg font-semibold text-center mb-2">Volume vs. Temperature (Celsius)</h3>
                        <canvas id="charles-vt-celsius-chart"></canvas>
                    </div>
                    
                    <!-- Data Table -->
                    <div class="mt-4">
                        <h3 class="text-lg font-semibold text-center mb-2">Recent Measurements</h3>
                        <div class="overflow-x-auto">
                            <table class="min-w-full divide-y divide-gray-200">
                                <thead class="bg-gray-50">
                                    <tr>
                                        <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Temp (K)</th>
                                        <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Temp (°C)</th>
                                        <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Volume (L)</th>
                                        <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">V / T</th>
                                    </tr>
                                </thead>
                                <tbody id="charles-data-table-body" class="bg-white divide-y divide-gray-200">
                                    <!-- Data rows will be populated by JavaScript -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Tab Switching Logic
        const boyleTab = document.getElementById('boyle-tab');
        const charlesTab = document.getElementById('charles-tab');
        const boyleExperiment = document.getElementById('boyle-experiment');
        const charlesExperiment = document.getElementById('charles-experiment');
        
        boyleTab.addEventListener('click', () => {
            boyleTab.classList.add('active');
            charlesTab.classList.remove('active');
            boyleExperiment.classList.remove('hidden');
            charlesExperiment.classList.add('hidden');
        });
        
        charlesTab.addEventListener('click', () => {
            charlesTab.classList.add('active');
            boyleTab.classList.remove('active');
            charlesExperiment.classList.remove('hidden');
            boyleExperiment.classList.add('hidden');
        });
        
        // Theory Toggle Logic
        const boyleTheoryBtn = document.getElementById('boyle-theory-btn');
        const charlesTheoryBtn = document.getElementById('charles-theory-btn');
        const boyleTheory = document.getElementById('boyle-theory');
        const charlesTheory = document.getElementById('charles-theory');
        
        boyleTheoryBtn.addEventListener('click', () => {
            boyleTheory.classList.toggle('open');
        });
        
        charlesTheoryBtn.addEventListener('click', () => {
            charlesTheory.classList.toggle('open');
        });
        
        // Back Button Logic
        const backBtn = document.getElementById('back-btn');
        backBtn.addEventListener('click', () => {
            alert('This would navigate back to the main menu in a complete application.');
        });

        // --- BOYLE'S LAW SIMULATION ---
        {
            // DOM Element References
            const volumeSlider = document.getElementById('boyle-volume-slider');
            const pressureSlider = document.getElementById('boyle-pressure-slider');
            const volumeDisplay = document.getElementById('boyle-volume-display');
            const pressureDisplay = document.getElementById('boyle-pressure-display');
            const pistonContainer = document.getElementById('boyle-piston-container');
            const piston = document.getElementById('boyle-piston');
            const pistonRod = document.getElementById('boyle-piston-rod');
            const gasContainer = document.getElementById('boyle-gas-container');
            const boyleEquation = document.getElementById('boyle-equation');
            const resetBtn = document.getElementById('boyle-reset-btn');
            const autoBtn = document.getElementById('boyle-auto-btn');
            const dataTableBody = document.getElementById('boyle-data-table-body');

            // Constants and Initial Values
            const INITIAL_VOLUME = 10; // Liters
            const INITIAL_PRESSURE = 1; // Atmospheres
            const BOYLE_CONSTANT = INITIAL_VOLUME * INITIAL_PRESSURE; // P1 * V1 = k
            const NUM_PARTICLES = 50;
            const CONTAINER_HEIGHT = 320; // in pixels

            let pvChart, pInvVChart;
            let autoCycleInterval = null;
            let isAutoCycling = false;
            let particles = [];

            // Particle Simulation
            function createParticles() {
                for (let i = 0; i < NUM_PARTICLES; i++) {
                    const particle = document.createElement('div');
                    particle.className = 'gas-particle';
                    particle.id = `boyle-particle-${i}`;
                    particle.style.backgroundColor = '#3b82f6';
                    
                    // Create unique movement pattern for each particle
                    const tx1 = Math.random() * 60 - 30;
                    const ty1 = Math.random() * 60 - 30;
                    const tx2 = Math.random() * 60 - 30;
                    const ty2 = Math.random() * 60 - 30;
                    const tx3 = Math.random() * 60 - 30;
                    const ty3 = Math.random() * 60 - 30;
                    
                    particle.style.setProperty('--tx1', `${tx1}px`);
                    particle.style.setProperty('--ty1', `${ty1}px`);
                    particle.style.setProperty('--tx2', `${tx2}px`);
                    particle.style.setProperty('--ty2', `${ty2}px`);
                    particle.style.setProperty('--tx3', `${tx3}px`);
                    particle.style.setProperty('--ty3', `${ty3}px`);
                    
                    gasContainer.appendChild(particle);
                    particles.push(particle);
                }
                updateParticlePositions(INITIAL_VOLUME);
            }

            function updateParticlePositions(currentVolume) {
                const minVolume = parseFloat(volumeSlider.min);
                const maxVolume = parseFloat(volumeSlider.max);
                
                // Calculate piston position based on volume
                const volumePercentage = (currentVolume - minVolume) / (maxVolume - minVolume);
                const pistonTop = (1 - volumePercentage) * CONTAINER_HEIGHT;
                
                // Update piston and rod positions
                pistonContainer.style.top = `${pistonTop}px`;
                pistonRod.style.height = `${pistonTop + 20}px`;
                
                // Calculate available height for particles (below piston)
                const availableHeight = CONTAINER_HEIGHT - pistonTop;
                
                // Calculate particle speed based on pressure (higher pressure = faster particles)
                const currentPressure = BOYLE_CONSTANT / currentVolume;
                const speedMultiplier = Math.sqrt(currentPressure); // Rough approximation for kinetic theory

                particles.forEach((p, i) => {
                    // Randomly place particles within the available space below the piston
                    const leftPos = Math.random() * 95;
                    const topPos = pistonTop + (Math.random() * availableHeight * 0.9);
                    
                    p.style.left = `${leftPos}%`;
                    p.style.top = `${topPos}px`;
                    
                    // Remove any existing animation
                    p.style.animation = 'none';
                    
                    // Add new animation with speed based on pressure
                    const duration = 10 / speedMultiplier;
                    const delay = Math.random() * -duration;
                    
                    // Create a more realistic movement pattern
                    p.style.animation = `moveParticle ${duration}s infinite linear ${delay}s`;
                });
            }
            
            // Charting
            function initializeCharts() {
                const commonOptions = {
                    responsive: true,
                    maintainAspectRatio: true,
                    scales: {
                        x: {
                            beginAtZero: true,
                            title: { display: true, text: '' },
                            grid: { color: '#e5e7eb' }
                        },
                        y: {
                            beginAtZero: true,
                            title: { display: true, text: '' },
                            grid: { color: '#e5e7eb' }
                        }
                    },
                    plugins: {
                        legend: { display: false },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    return `${context.dataset.label}: ${context.parsed.y.toFixed(2)}`;
                                }
                            }
                        }
                    },
                    elements: {
                        line: {
                            tension: 0.1
                        }
                    }
                };

                // Chart 1: Pressure vs. Volume
                const pvCtx = document.getElementById('boyle-pv-chart').getContext('2d');
                pvChart = new Chart(pvCtx, {
                    type: 'scatter',
                    data: {
                        datasets: [{
                            label: 'Pressure (atm)',
                            data: [],
                            borderColor: '#ef4444', // red-500
                            backgroundColor: '#fecaca', // red-200
                            borderWidth: 2,
                            pointRadius: 4,
                            pointBackgroundColor: '#ef4444'
                        }]
                    },
                    options: {
                        ...commonOptions,
                        scales: {
                            ...commonOptions.scales,
                            x: { 
                                ...commonOptions.scales.x, 
                                title: { ...commonOptions.scales.x.title, text: 'Volume (L)' } 
                            },
                            y: { 
                                ...commonOptions.scales.y, 
                                title: { ...commonOptions.scales.y.title, text: 'Pressure (atm)' } 
                            }
                        }
                    }
                });

                // Chart 2: Pressure vs. 1/Volume
                const pInvVCtx = document.getElementById('boyle-p-inv-v-chart').getContext('2d');
                pInvVChart = new Chart(pInvVCtx, {
                    type: 'scatter',
                    data: {
                        datasets: [{
                            label: 'Pressure (atm)',
                            data: [],
                            borderColor: '#22c55e', // green-500
                            backgroundColor: '#bbf7d0', // green-200
                            borderWidth: 2,
                            pointRadius: 4,
                            pointBackgroundColor: '#22c55e'
                        }]
                    },
                    options: {
                        ...commonOptions,
                        scales: {
                            ...commonOptions.scales,
                            x: { 
                                ...commonOptions.scales.x, 
                                title: { ...commonOptions.scales.x.title, text: '1 / Volume (1/L)' } 
                            },
                            y: { 
                                ...commonOptions.scales.y, 
                                title: { ...commonOptions.scales.y.title, text: 'Pressure (atm)' } 
                            }
                        }
                    }
                });
            }

            function updateCharts(volume, pressure) {
                const invVolume = 1 / volume;

                // Update P vs V chart
                pvChart.data.datasets[0].data.push({x: volume, y: pressure});
                
                // Keep the graph from getting too crowded
                if(pvChart.data.datasets[0].data.length > 20) {
                    pvChart.data.datasets[0].data.shift();
                }
                pvChart.update();
                
                // Update P vs 1/V chart
                pInvVChart.data.datasets[0].data.push({x: invVolume, y: pressure});

                if(pInvVChart.data.datasets[0].data.length > 20) {
                    pInvVChart.data.datasets[0].data.shift();
                }
                pInvVChart.update();
                
                // Update data table
                updateDataTable(volume, pressure);
            }
            
            function updateDataTable(volume, pressure) {
                // Add new row to the table
                const newRow = document.createElement('tr');
                newRow.className = 'hover:bg-gray-50';
                
                const volumeCell = document.createElement('td');
                volumeCell.className = 'px-4 py-2 whitespace-nowrap text-sm text-gray-900';
                volumeCell.textContent = volume.toFixed(2);
                
                const pressureCell = document.createElement('td');
                pressureCell.className = 'px-4 py-2 whitespace-nowrap text-sm text-gray-900';
                pressureCell.textContent = pressure.toFixed(2);
                
                const productCell = document.createElement('td');
                productCell.className = 'px-4 py-2 whitespace-nowrap text-sm text-gray-900';
                productCell.textContent = (volume * pressure).toFixed(2);
                
                newRow.appendChild(volumeCell);
                newRow.appendChild(pressureCell);
                newRow.appendChild(productCell);
                
                // Add the new row at the top
                dataTableBody.insertBefore(newRow, dataTableBody.firstChild);
                
                // Keep only the last 10 rows
                while (dataTableBody.children.length > 10) {
                    dataTableBody.removeChild(dataTableBody.lastChild);
                }
                
                // Highlight the new row temporarily
                newRow.classList.add('highlight');
                setTimeout(() => {
                    newRow.classList.remove('highlight');
                }, 1000);
            }

            // Main Simulation Logic
            function updateSimulation() {
                const currentVolume = parseFloat(volumeSlider.value);
                const newPressure = BOYLE_CONSTANT / currentVolume;

                // Update displays
                volumeDisplay.textContent = `${currentVolume.toFixed(1)} L`;
                pressureDisplay.textContent = `${newPressure.toFixed(2)} atm`;
                boyleEquation.textContent = `${newPressure.toFixed(2)} × ${currentVolume.toFixed(1)} = ${(newPressure * currentVolume).toFixed(1)}`;

                // Update particle positions to be within the new volume
                updateParticlePositions(currentVolume);

                // Add data point to chart every few steps to avoid clutter
                const lastDataPoint = pvChart.data.datasets[0].data[pvChart.data.datasets[0].data.length - 1];
                if (!lastDataPoint || Math.abs(currentVolume - lastDataPoint.x) > 0.5) {
                     updateCharts(currentVolume, newPressure);
                }
            }
            
            function updateFromPressure() {
                const currentPressure = parseFloat(pressureSlider.value);
                const newVolume = BOYLE_CONSTANT / currentPressure;
                
                // Update volume slider
                volumeSlider.value = newVolume;
                
                // Update simulation
                updateSimulation();
            }
            
            function resetExperiment() {
                volumeSlider.value = INITIAL_VOLUME;
                pressureSlider.value = INITIAL_PRESSURE;
                updateSimulation();
                
                // Clear charts
                pvChart.data.datasets[0].data = [];
                pInvVChart.data.datasets[0].data = [];
                pvChart.update();
                pInvVChart.update();
                
                // Clear data table
                dataTableBody.innerHTML = '';
                
                // Stop auto cycle if running
                if (isAutoCycling) {
                    toggleAutoCycle();
                }
            }
            
            function toggleAutoCycle() {
                if (isAutoCycling) {
                    clearInterval(autoCycleInterval);
                    autoBtn.textContent = 'Auto Cycle';
                    autoBtn.classList.remove('bg-red-500', 'hover:bg-red-600');
                    autoBtn.classList.add('bg-blue-500', 'hover:bg-blue-600');
                    isAutoCycling = false;
                } else {
                    let direction = 1; // 1 for increasing, -1 for decreasing
                    autoCycleInterval = setInterval(() => {
                        let newVolume = parseFloat(volumeSlider.value) + (0.1 * direction);
                        
                        if (newVolume >= parseFloat(volumeSlider.max)) {
                            newVolume = parseFloat(volumeSlider.max);
                            direction = -1;
                        } else if (newVolume <= parseFloat(volumeSlider.min)) {
                            newVolume = parseFloat(volumeSlider.min);
                            direction = 1;
                        }
                        
                        volumeSlider.value = newVolume;
                        updateSimulation();
                    }, 300);
                    
                    autoBtn.textContent = 'Stop Cycle';
                    autoBtn.classList.remove('bg-blue-500', 'hover:bg-blue-600');
                    autoBtn.classList.add('bg-red-500', 'hover:bg-red-600');
                    isAutoCycling = true;
                }
            }

            // Event Listeners
            volumeSlider.addEventListener('input', updateSimulation);
            pressureSlider.addEventListener('input', updateFromPressure);
            resetBtn.addEventListener('click', resetExperiment);
            autoBtn.addEventListener('click', toggleAutoCycle);

            // Initialization
            initializeCharts();
            createParticles();
            updateSimulation();
            updateCharts(INITIAL_VOLUME, INITIAL_PRESSURE);
        }

        // --- CHARLES'S LAW SIMULATION ---
        {
            // DOM Element References
            const temperatureSlider = document.getElementById('charles-temperature-slider');
            const volumeSlider = document.getElementById('charles-volume-slider');
            const volumeDisplay = document.getElementById('charles-volume-display');
            const temperatureDisplay = document.getElementById('charles-temperature-display');
            const pressureDisplay = document.getElementById('charles-pressure-display');
            const pistonContainer = document.getElementById('charles-piston-container');
            const piston = document.getElementById('charles-piston');
            const pistonRod = document.getElementById('charles-piston-rod');
            const gasContainer = document.getElementById('charles-gas-container');
            const temperatureFill = document.getElementById('charles-temperature-fill');
            const flame = document.getElementById('charles-flame');
            const charlesEquation = document.getElementById('charles-equation');
            const resetBtn = document.getElementById('charles-reset-btn');
            const autoBtn = document.getElementById('charles-auto-btn');
            const dataTableBody = document.getElementById('charles-data-table-body');

            // Constants and Initial Values
            const INITIAL_TEMPERATURE = 273; // Kelvin (0°C)
            const INITIAL_VOLUME = 10; // Liters
            const CONSTANT_PRESSURE = 1; // Atmospheres
            const CHARLES_CONSTANT = INITIAL_VOLUME / INITIAL_TEMPERATURE; // V1 / T1 = k
            const ABSOLUTE_ZERO = -273; // Celsius
            const NUM_PARTICLES = 50;
            const CONTAINER_HEIGHT = 320; // in pixels

            let vtChart, vtCelsiusChart;
            let autoCycleInterval = null;
            let isAutoCycling = false;
            let particles = [];

            // Particle Simulation
            function createParticles() {
                for (let i = 0; i < NUM_PARTICLES; i++) {
                    const particle = document.createElement('div');
                    particle.className = 'gas-particle';
                    particle.id = `charles-particle-${i}`;
                    
                    // Create unique movement pattern for each particle
                    const tx1 = Math.random() * 60 - 30;
                    const ty1 = Math.random() * 60 - 30;
                    const tx2 = Math.random() * 60 - 30;
                    const ty2 = Math.random() * 60 - 30;
                    const tx3 = Math.random() * 60 - 30;
                    const ty3 = Math.random() * 60 - 30;
                    
                    particle.style.setProperty('--tx1', `${tx1}px`);
                    particle.style.setProperty('--ty1', `${ty1}px`);
                    particle.style.setProperty('--tx2', `${tx2}px`);
                    particle.style.setProperty('--ty2', `${ty2}px`);
                    particle.style.setProperty('--tx3', `${tx3}px`);
                    particle.style.setProperty('--ty3', `${ty3}px`);
                    
                    gasContainer.appendChild(particle);
                    particles.push(particle);
                }
                updateParticlePositions(INITIAL_VOLUME, INITIAL_TEMPERATURE);
            }

            function updateParticlePositions(currentVolume, currentTemperature) {
                const minVolume = parseFloat(volumeSlider.min);
                const maxVolume = parseFloat(volumeSlider.max);
                
                // Calculate piston position based on volume
                const volumePercentage = (currentVolume - minVolume) / (maxVolume - minVolume);
                const pistonTop = (1 - volumePercentage) * CONTAINER_HEIGHT;
                
                // Update piston and rod positions
                pistonContainer.style.top = `${pistonTop}px`;
                pistonRod.style.height = `${pistonTop + 20}px`;
                
                // Calculate available height for particles (below piston)
                const availableHeight = CONTAINER_HEIGHT - pistonTop;
                
                // Update temperature indicator
                const tempPercentage = currentTemperature / parseFloat(temperatureSlider.max);
                temperatureFill.style.height = `${tempPercentage * 100}%`;
                temperatureFill.style.background = `linear-gradient(to top, #3b82f6, #ef4444 ${tempPercentage * 100}%)`;
                
                // Update flame visibility based on temperature
                if (currentTemperature > INITIAL_TEMPERATURE) {
                    flame.classList.add('active');
                } else {
                    flame.classList.remove('active');
                }
                
                // Calculate particle speed based on temperature (higher temperature = faster particles)
                const speedMultiplier = Math.sqrt(currentTemperature / INITIAL_TEMPERATURE);

                // Update particle colors based on temperature (cooler = blue, hotter = red)
                const tempRatio = (currentTemperature - INITIAL_TEMPERATURE) / (parseFloat(temperatureSlider.max) - INITIAL_TEMPERATURE);
                const r = Math.min(255, 59 + Math.floor(196 * tempRatio));
                const g = Math.min(255, 130 - Math.floor(100 * tempRatio));
                const b = Math.max(0, 246 - Math.floor(200 * tempRatio));
                const particleColor = `rgb(${r}, ${g}, ${b})`;

                particles.forEach((p, i) => {
                    // Randomly place particles within the available space below the piston
                    const leftPos = Math.random() * 95;
                    const topPos = pistonTop + (Math.random() * availableHeight * 0.9);
                    
                    p.style.left = `${leftPos}%`;
                    p.style.top = `${topPos}px`;
                    p.style.backgroundColor = particleColor;
                    
                    // Remove any existing animation
                    p.style.animation = 'none';
                    
                    // Add new animation with speed based on temperature
                    const duration = 10 / speedMultiplier;
                    const delay = Math.random() * -duration;
                    
                    // Create a more realistic movement pattern
                    p.style.animation = `moveParticle ${duration}s infinite linear ${delay}s`;
                });
            }
            
            // Charting
            function initializeCharts() {
                const commonOptions = {
                    responsive: true,
                    maintainAspectRatio: true,
                    scales: {
                        x: {
                            beginAtZero: false,
                            title: { display: true, text: '' },
                            grid: { color: '#e5e7eb' }
                        },
                        y: {
                            beginAtZero: false,
                            title: { display: true, text: '' },
                            grid: { color: '#e5e7eb' }
                        }
                    },
                    plugins: {
                        legend: { display: false },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    return `${context.dataset.label}: ${context.parsed.y.toFixed(2)}`;
                                }
                            }
                        }
                    },
                    elements: {
                        line: {
                            tension: 0.1
                        }
                    }
                };

                // Chart 1: Volume vs. Temperature (Kelvin)
                const vtCtx = document.getElementById('charles-vt-chart').getContext('2d');
                vtChart = new Chart(vtCtx, {
                    type: 'scatter',
                    data: {
                        datasets: [{
                            label: 'Volume (L)',
                            data: [],
                            borderColor: '#ef4444', // red-500
                            backgroundColor: '#fecaca', // red-200
                            borderWidth: 2,
                            pointRadius: 4,
                            pointBackgroundColor: '#ef4444'
                        }]
                    },
                    options: {
                        ...commonOptions,
                        scales: {
                            ...commonOptions.scales,
                            x: { 
                                ...commonOptions.scales.x, 
                                title: { ...commonOptions.scales.x.title, text: 'Temperature (K)' } 
                            },
                            y: { 
                                ...commonOptions.scales.y, 
                                title: { ...commonOptions.scales.y.title, text: 'Volume (L)' } 
                            }
                        }
                    }
                });

                // Chart 2: Volume vs. Temperature (Celsius)
                const vtCelsiusCtx = document.getElementById('charles-vt-celsius-chart').getContext('2d');
                vtCelsiusChart = new Chart(vtCelsiusCtx, {
                    type: 'scatter',
                    data: {
                        datasets: [{
                            label: 'Volume (L)',
                            data: [],
                            borderColor: '#22c55e', // green-500
                            backgroundColor: '#bbf7d0', // green-200
                            borderWidth: 2,
                            pointRadius: 4,
                            pointBackgroundColor: '#22c55e'
                        }]
                    },
                    options: {
                        ...commonOptions,
                        scales: {
                            ...commonOptions.scales,
                            x: { 
                                ...commonOptions.scales.x, 
                                title: { ...commonOptions.scales.x.title, text: 'Temperature (°C)' } 
                            },
                            y: { 
                                ...commonOptions.scales.y, 
                                title: { ...commonOptions.scales.y.title, text: 'Volume (L)' } 
                            }
                        }
                    }
                });
            }

            function updateCharts(temperature, volume) {
                const temperatureCelsius = temperature - 273;

                // Update V vs T (Kelvin) chart
                vtChart.data.datasets[0].data.push({x: temperature, y: volume});
                
                // Keep the graph from getting too crowded
                if(vtChart.data.datasets[0].data.length > 20) {
                    vtChart.data.datasets[0].data.shift();
                }
                vtChart.update();
                
                // Update V vs T (Celsius) chart
                vtCelsiusChart.data.datasets[0].data.push({x: temperatureCelsius, y: volume});

                if(vtCelsiusChart.data.datasets[0].data.length > 20) {
                    vtCelsiusChart.data.datasets[0].data.shift();
                }
                vtCelsiusChart.update();
                
                // Update data table
                updateDataTable(temperature, volume);
            }
            
            function updateDataTable(temperature, volume) {
                const temperatureCelsius = temperature - 273;
                
                // Add new row to the table
                const newRow = document.createElement('tr');
                newRow.className = 'hover:bg-gray-50';
                
                const tempKCell = document.createElement('td');
                tempKCell.className = 'px-4 py-2 whitespace-nowrap text-sm text-gray-900';
                tempKCell.textContent = temperature.toFixed(0);
                
                const tempCCell = document.createElement('td');
                tempCCell.className = 'px-4 py-2 whitespace-nowrap text-sm text-gray-900';
                tempCCell.textContent = temperatureCelsius.toFixed(0);
                
                const volumeCell = document.createElement('td');
                volumeCell.className = 'px-4 py-2 whitespace-nowrap text-sm text-gray-900';
                volumeCell.textContent = volume.toFixed(2);
                
                const ratioCell = document.createElement('td');
                ratioCell.className = 'px-4 py-2 whitespace-nowrap text-sm text-gray-900';
                ratioCell.textContent = (volume / temperature).toFixed(4);
                
                newRow.appendChild(tempKCell);
                newRow.appendChild(tempCCell);
                newRow.appendChild(volumeCell);
                newRow.appendChild(ratioCell);
                
                // Add the new row at the top
                dataTableBody.insertBefore(newRow, dataTableBody.firstChild);
                
                // Keep only the last 10 rows
                while (dataTableBody.children.length > 10) {
                    dataTableBody.removeChild(dataTableBody.lastChild);
                }
                
                // Highlight the new row temporarily
                newRow.classList.add('highlight');
                setTimeout(() => {
                    newRow.classList.remove('highlight');
                }, 1000);
            }

            // Main Simulation Logic
            function updateSimulation() {
                const currentTemperature = parseFloat(temperatureSlider.value);
                const newVolume = CHARLES_CONSTANT * currentTemperature;

                // Update displays
                volumeDisplay.textContent = `${newVolume.toFixed(1)} L`;
                temperatureDisplay.textContent = `${currentTemperature.toFixed(0)} K`;
                pressureDisplay.textContent = `${CONSTANT_PRESSURE.toFixed(2)} atm`;
                charlesEquation.textContent = `${newVolume.toFixed(2)} / ${currentTemperature.toFixed(0)} = ${(newVolume / currentTemperature).toFixed(4)}`;

                // Update volume slider to match calculated volume
                volumeSlider.value = newVolume;

                // Update particle positions to be within the new volume
                updateParticlePositions(newVolume, currentTemperature);

                // Add data point to chart every few steps to avoid clutter
                const lastDataPoint = vtChart.data.datasets[0].data[vtChart.data.datasets[0].data.length - 1];
                if (!lastDataPoint || Math.abs(currentTemperature - lastDataPoint.x) > 20) {
                     updateCharts(currentTemperature, newVolume);
                }
            }
            
            function updateFromVolume() {
                const currentVolume = parseFloat(volumeSlider.value);
                const newTemperature = currentVolume / CHARLES_CONSTANT;
                
                // Update temperature slider
                temperatureSlider.value = newTemperature;
                
                // Update simulation
                updateSimulation();
            }
            
            function resetExperiment() {
                temperatureSlider.value = INITIAL_TEMPERATURE;
                volumeSlider.value = INITIAL_VOLUME;
                updateSimulation();
                
                // Clear charts
                vtChart.data.datasets[0].data = [];
                vtCelsiusChart.data.datasets[0].data = [];
                vtChart.update();
                vtCelsiusChart.update();
                
                // Clear data table
                dataTableBody.innerHTML = '';
                
                // Stop auto cycle if running
                if (isAutoCycling) {
                    toggleAutoCycle();
                }
            }
            
            function toggleAutoCycle() {
                if (isAutoCycling) {
                    clearInterval(autoCycleInterval);
                    autoBtn.textContent = 'Auto Cycle';
                    autoBtn.classList.remove('bg-red-500', 'hover:bg-red-600');
                    autoBtn.classList.add('bg-blue-500', 'hover:bg-blue-600');
                    isAutoCycling = false;
                } else {
                    let direction = 1; // 1 for increasing, -1 for decreasing
                    autoCycleInterval = setInterval(() => {
                        let newTemperature = parseFloat(temperatureSlider.value) + (5 * direction);
                        
                        if (newTemperature >= parseFloat(temperatureSlider.max)) {
                            newTemperature = parseFloat(temperatureSlider.max);
                            direction = -1;
                        } else if (newTemperature <= parseFloat(temperatureSlider.min)) {
                            newTemperature = parseFloat(temperatureSlider.min);
                            direction = 1;
                        }
                        
                        temperatureSlider.value = newTemperature;
                        updateSimulation();
                    }, 300);
                    
                    autoBtn.textContent = 'Stop Cycle';
                    autoBtn.classList.remove('bg-blue-500', 'hover:bg-blue-600');
                    autoBtn.classList.add('bg-red-500', 'hover:bg-red-600');
                    isAutoCycling = true;
                }
            }

            // Event Listeners
            temperatureSlider.addEventListener('input', updateSimulation);
            volumeSlider.addEventListener('input', updateFromVolume);
            resetBtn.addEventListener('click', resetExperiment);
            autoBtn.addEventListener('click', toggleAutoCycle);

            // Initialization
            initializeCharts();
            createParticles();
            updateSimulation();
            updateCharts(INITIAL_TEMPERATURE, INITIAL_VOLUME);
        }
    </script>
</body>
</html>